m{% extends "base.html" %}
{% load metadataform_tags %}

{% block extra_styles %}<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/library.css" />{% endblock %}

{% block custom_scripts %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.core.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.contextmenu.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.themes.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.html.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.ui.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.dnd.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/vakata.js"></script>
    
    
    <script type="text/javascript">
        var media_url = "{{ MEDIA_URL }}";
        var app_url = "{{ request.META.SCRIPT_NAME }}";
        var ajax_prefix = "{{ AJAX_PREFIX }}";
        //alert(ajax_prefix)
	</script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/inflection.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/application.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/libraryinteractions.js"></script> <!-- Mine -->
    <script type="text/javascript" src="{{ MEDIA_URL }}js/libraryitems.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/collectionitems.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.timeago.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}js/windowflip.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}js/librarydisplay.js"></script>
    
{% endblock %}

{% block title %}
    {{ requested_user.first_name }} {{ requested_user.last_name }}'s Library
{% endblock %}


{% block content %}
        
    <div id="panels">

        <div id="left">
            <header class="panelheader">
                <h2>Folders</h2>
            </header>
            <div class="handle"></div>
            
            <div id="folders">
                <div id="folder_tree">
                    {% include "libraryitems/index.html" %}   
                </div>  
                {% if requested_user == current_user %}
                    <a id="new_folder" class="button modal remote" href="{{ request.META.SCRIPT_NAME }}/folders/new">new&nbsp;folder</a>
                {% endif %}          
            </div>  
            
            <div id="collections">
                <h2>Your Collections</h2>                
                <div id="collection_tree">
                    {% include "collectionitems/index.html" %}
                </div>
                {% if requested_user == current_user %}
                    <a id="new_collection" class="button modal remote" href="{{ request.META.SCRIPT_NAME }}/collections/new">new&nbsp;collection</a>
                {% endif %}
                
            </div>
       </div><!--/#left-->
       
        
        <div id="library" role="main" class="center">
            
            <div id="collect">
    
                <header class="panelheader">
                </header>
                
                <div id="collection_options">
                	<h1>Collect stuff to add to your Library!</h1>
                    <h2>How should you collect? Here are your options.</h2>
                    <ul>
                    	<li><a href="#" id="upload"><h3>Simple File Upload</h3> Upload documents one at-a-time (or as a batch)!</a></li>
                    	<li><a href="#" id="dropbox"><h3>Sync with DropBox</h3> Install a plug-in to manage your files easily from your DropBox folder.</a></li>
                    	<li><a href="#" id="citations"><h3>Import citations</h3> Connect your Zotero, Diigo, or Endnote account.</a></li>
                    	<li><a href="#" id="email"><h3>E-mail attachments</h3> Add items to your library by attaching them to an e-mail!</a></li>
                    </ul>
                </div>
                
            </div>
        
            <div id="library-items">
        
                <header class="panelheader">
                    <h2>Your items</h2>
                    <ul class="view">
                        <li><a class="button active" href="#" id="list_view">List</a></li>
                        <li><a class="button" href="#" id="icon_view">Icon</a></li>
                    </ul>
                </header>
            	
				{% if current_assets %}
                    <div id="files" class="innerpane">
                        <header>
                            <abbr class="size">Size</abbr>
                            <abbr class="modified">Last Modified</abbr>
                            <abbr class="filetype">Type</abbr>
                            <h3>Item</h3>
                        </header>
                        <ol class="items"> 
							{% for asset in current_assets %}
                                <li id="{{asset.id}}" data-asset-id="{{asset.id}}">
                                    <a href="#">
                                        <abbr class="size">{{ asset.file.size|filesizeformat }}</abbr>
                                        <abbr class="modified">{{ asset.modified|timesince }} ago</abbr>
                                        <abbr class="filetype">
                                            {% for type in asset.filetype.all %}
                                                {{ type.name }}
                                            {% endfor %}
                                        </abbr>
                                        <h3>{{ asset.name }}</h3>                                        
                                    </a>
                                </li>  
							{% endfor %}                             
                        </ol>
                    </div>  

				{% endif %}
				
                <iframe id="upload_target" name="upload_target" src="" style="width:0px;height:0px;"></iframe>
                <div id="fileupload">
                    Add an item using the form below:
                    <form action="{% url ajax_create_asset %}" method="post" enctype="multipart/form-data" id="fileupload-form" target="upload_target">{% csrf_token %}
                    <p>
                        {{ file_upload_form.file }}
                    </p>
                    <!-- This is the file input goes -->
                    <noscript>          
                    	<p>Please enable JavaScript to use file uploader.</p>
                        <!-- or put a simple form for upload here -->
                    </noscript> 
                    <input type="submit" value="Upload File" />
                    
                    </form>
                </div>	 
                
            </div><!--/#library-items-->
                    
        </div><!--/#library-->
        
        <div id="right">
            <header class="panelheader">
                    <h2>Meta</h2>
            </header>
            <div class="handle"></div>
            <!--<div class="meta default">
                <div class="data">
                    <div class="preview empty">
                        No item Selected!
                    </div>
                </div>
            </div>-->
            <div class="meta">
                <div class="data">
                    <ul id="metadata-details"></ul>
                    <br class="clear" />
                    <h3>Add new metadata</h3>
                    {% display_metadata_form request %}

                    <h3>Tags <span class="tags-edit"><a href="#">Add Tags</a></span></h3>
                    <p id="tag-details"></p>
                    <!-- <h3> Add tags </h3> -->
                    {% display_tag_form request %}
                </div>
            </div>
        </div><!--/#right-->
        
    </div><!--/#panels-->
        
{% endblock %}

{% block footer %}	
        
    <div id="upload-button">
        <p>Upload +</p>
    </div>
        
    <nav id="actions">
        <ul>
            <li><a href="#">Edit</a></li>
            <li><a href="#">Reflect</a></li>
            <li><a href="#">Publish</a></li>
            <li><a href="#">Share</a></li>
            <li><a href="#">Submit</a></li>
        </ul>
    </nav>

{% endblock %}