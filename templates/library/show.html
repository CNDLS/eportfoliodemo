{% extends "base.html" %}

{% load mptt_tags %}

{% block custom_scripts %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.core.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.core.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.themes.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.html.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.ui.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.types.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/jstree.dnd.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jstree/vakata.js"></script>
    <script type="text/javascript">
        $(function () {
        	// TO CREATE AN INSTANCE
        	// select the tree container using jQuery
        	$("#folder_tree")
        		// call `.jstree` with the options object
        		.jstree({
        			"plugins" : ["themes","html_data","ui","types","dnd"],
        			"themes" : {
        			            "url" : "{{ MEDIA_URL }}js/jstree/themes/apple/style.css",
                                "theme" : "apple",
                                "dots" : false,
                                "icons" : true
                                },
        			"json_data" : { 
            			// This tree is ajax enabled - as this is most common, and maybe a bit more complex
            			// All the options are almost the same as jQuery's AJAX (read the docs)
            			"ajax" : {
            				// the URL to fetch the data
            				"url" : "folders/",
            				// the `data` function is executed in the instance's scope
            				// the parameter is the node being loaded 
            				// (may be -1, 0, or undefined when loading the root nodes)
            				"data" : function (n) { 
            					// the result is fed to the AJAX request `data` option
            					return { 
            						"operation" : "get_children", 
            						"id" : n.attr ? n.attr("id").replace("node_","") : 1 
            					}; 
            				}
            			}
            		},
        			"core" : {}
        		})
        		// EVENTS
        		// each instance triggers its own events - to process those listen on the container
        		// all events are in the `.jstree` namespace
        		// so listen for `function_name`.`jstree` - you can function names from the docs
                // .bind("loaded.jstree", function (event, data) {
                //  // you get two params - event & data - check the core docs for a detailed description
                // });
        });
    </script>
{% endblock %}

{% block title %}
    {{ requested_user.first_name }} {{ requested_user.last_name }}'s Library
{% endblock %}


{% block content %}
<h3>Folders</h3>
<div id="folder_tree">
    <ul class="tree root">
        {% recursetree nodes %}
            <li>
                {{ node.name }}
                {% if not node.is_leaf_node %}
                    <ul class="children">
                        {{ children }}
                    </ul>
                {% endif %}
            </li>
        {% endrecursetree %}
    </ul>
</div>    
{% if requested_user == current_user %}
    <a href="{{ request.META.SCRIPT_NAME }}/folders/new">+ Add Folder</a></li>
{% endif %}

<hr />
<h3>Collections</h3>
<ul>
    {% for collection in collections %}
        <li><a href="#">{{ collection }}</a></li>
    {% endfor %}
</ul>
{% endblock %}